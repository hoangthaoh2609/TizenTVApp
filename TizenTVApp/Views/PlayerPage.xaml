<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:TizenTVApp.ViewModels"
             xmlns:models="clr-namespace:TizenTVApp.Models"
             x:Class="TizenTVApp.Views.PlayerPage"
             x:DataType="vm:PlayerViewModel"
             BackgroundColor="{StaticResource BackgroundDark}">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Video Player Area -->
        <Grid Grid.Row="0" BackgroundColor="{StaticResource BackgroundDark}">
            <!-- Video player will be rendered here by platform-specific code -->
            <BoxView Color="{StaticResource BackgroundDark}" />

            <!-- Subtitle Display -->
            <Label Grid.Row="0"
                   Text="{Binding CurrentSubtitle}"
                   TextColor="{StaticResource TextPrimary}"
                   FontSize="32"
                   FontAttributes="Bold"
                   HorizontalOptions="Center"
                   VerticalOptions="End"
                   Margin="0,0,0,150"
                   BackgroundColor="{StaticResource OverlayDark}"
                   Padding="20,10"
                   IsVisible="{Binding CurrentSubtitle, Converter={StaticResource IsNotNullOrEmptyConverter}}" />

            <!-- Loading Indicator -->
            <ActivityIndicator IsRunning="{Binding IsLoading}"
                             IsVisible="{Binding IsLoading}"
                             Style="{StaticResource LoadingIndicatorStyle}"
                             HorizontalOptions="Center"
                             VerticalOptions="Center" />
        </Grid>

        <!-- Player Controls -->
        <Grid Grid.Row="1"
              BackgroundColor="{StaticResource OverlayDark}"
              Padding="40,20"
              IsVisible="{Binding IsControlsVisible}">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!-- Progress Bar -->
            <Grid Grid.Row="0" ColumnSpacing="20">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <Label Grid.Column="0"
                       Text="{Binding FormattedPosition}"
                       Style="{StaticResource CaptionLabelStyle}"
                       VerticalOptions="Center" />

                <Slider Grid.Column="1"
                        Minimum="0"
                        Maximum="100"
                        Value="{Binding ProgressPercentage}"
                        Style="{StaticResource PlayerSliderStyle}"
                        DragCompletedCommand="{Binding SeekToCommand}"
                        ValueChanged="OnSliderValueChanged" />

                <Label Grid.Column="2"
                       Text="{Binding FormattedDuration}"
                       Style="{StaticResource CaptionLabelStyle}"
                       VerticalOptions="Center" />
            </Grid>

            <!-- Playback Controls -->
            <HorizontalStackLayout Grid.Row="1"
                                  Spacing="20"
                                  HorizontalOptions="Center"
                                  Margin="0,20,0,0">
                <Button Text="◀◀"
                        Style="{StaticResource SecondaryButtonStyle}"
                        Command="{Binding SeekBackwardCommand}"
                        CommandParameter="10"
                        WidthRequest="100" />

                <Button Text="▶"
                        Style="{StaticResource PrimaryButtonStyle}"
                        Command="{Binding PlayCommand}"
                        IsVisible="{Binding IsPaused}"
                        WidthRequest="120" />

                <Button Text="⏸"
                        Style="{StaticResource PrimaryButtonStyle}"
                        Command="{Binding PauseCommand}"
                        IsVisible="{Binding IsPlaying}"
                        WidthRequest="120" />

                <Button Text="⏹"
                        Style="{StaticResource SecondaryButtonStyle}"
                        Command="{Binding StopCommand}"
                        WidthRequest="100" />

                <Button Text="▶▶"
                        Style="{StaticResource SecondaryButtonStyle}"
                        Command="{Binding SeekForwardCommand}"
                        CommandParameter="10"
                        WidthRequest="100" />
            </HorizontalStackLayout>

            <!-- Additional Controls -->
            <Grid Grid.Row="2" Margin="0,20,0,0" ColumnSpacing="20">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <!-- Video Info -->
                <VerticalStackLayout Grid.Column="0" Spacing="5">
                    <Label Text="{Binding CurrentVideo.Title}"
                           Style="{StaticResource TitleLabelStyle}" />
                    <Label Text="{Binding CurrentVideo.Description}"
                           Style="{StaticResource CaptionLabelStyle}"
                           LineBreakMode="TailTruncation"
                           MaxLines="2" />
                </VerticalStackLayout>

                <!-- Subtitle Selection -->
                <Picker Grid.Column="1"
                        Title="Subtitles"
                        ItemsSource="{Binding AvailableSubtitles}"
                        ItemDisplayBinding="{Binding Label}"
                        SelectedItem="{Binding SelectedSubtitleTrack}"
                        TextColor="{StaticResource TextPrimary}"
                        BackgroundColor="{StaticResource Surface}"
                        FontSize="24"
                        WidthRequest="250"
                        VerticalOptions="Center" />

                <!-- Close Button -->
                <Button Grid.Column="2"
                        Text="✕ Close"
                        Style="{StaticResource SecondaryButtonStyle}"
                        Command="{Binding CloseCommand}"
                        WidthRequest="150" />
            </Grid>
        </Grid>
    </Grid>

</ContentPage>
